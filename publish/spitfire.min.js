var SPITFIRE=SPITFIRE||{};var $s=$s||SPITFIRE;SPITFIRE.browser={};SPITFIRE.browser.Opera=window.opera?true:false;SPITFIRE.browser.IE=document.all&&!SPITFIRE.browser.Opera?true:false;SPITFIRE.browser.IE6=SPITFIRE.browser.IE&&typeof(window.XMLHttpRequest)==="undefined"?true:false;SPITFIRE.browser.IE8=SPITFIRE.browser.IE&&typeof(document.querySelectorAll)!=="undefined"?true:false;SPITFIRE.browser.IE7=SPITFIRE.browser.IE&&!SPITFIRE.browser.IE6&&!SPITFIRE.browser.IE8?true:false;SPITFIRE.browser.WebKit=/WebKit/i.test(navigator.userAgent)?true:false;SPITFIRE.browser.iPhone=/iPhone|iPod/i.test(navigator.userAgent)?true:false;SPITFIRE.browser.Chrome=/Chrome/i.test(navigator.userAgent)?true:false;SPITFIRE.browser.Safari=/Safari/i.test(navigator.userAgent)&&!SPITFIRE.browser.Chrome?true:false;SPITFIRE.browser.Konqueror=navigator.vendor==="KDE"?true:false;SPITFIRE.browser.Konqueror4=SPITFIRE.browser.Konqueror&&/native code/.test(document.getElementsByClassName)?true:false;SPITFIRE.browser.Gecko=!SPITFIRE.browser.WebKit&&navigator.product==="Gecko"?true:false;SPITFIRE.browser.Gecko19=SPITFIRE.browser.Gecko&&Array.reduce?true:false;SPITFIRE.isArray=function(a){return typeof a==="object"&&a.length};SPITFIRE.isFunction=function(a){return typeof a==="function"};SPITFIRE.isWindow=function(a){return a&&typeof a==="object"&&"setInterval" in a};SPITFIRE.isPlainObject=function(c){if(!c||typeof c!=="object"||c.nodeType||SPITFIRE.isWindow(c)){return false}var a=Object.prototype.hasOwnProperty,b;if(c.constructor&&!a.call(c,"constructor")&&!a.call(c.constructor.prototype,"isPrototypeOf")){return false}return typeof b==="undefined"||a.call(c,b)};SPITFIRE.isSynthesizedProperty=function(f,c){var b=c.synthesizedProperties,e=false,d,a;if(b){for(d=0,a=b.length;d<a;d+=1){if(b[d]===f){e=true;break}}}return e};SPITFIRE.objectHasMethod=function(a,b){return a!==null&&a[b]!==undefined&&SPITFIRE.isFunction(a[b])};SPITFIRE.slice=function(e,d,c){var a=[],b;for(b=d;b<=c;b+=1){a.push(e[b])}return a};SPITFIRE.extend=function(){var m,c,a,b,h,k,g=arguments[0]||{},f=1,d=arguments.length,l=false,j,e;if(typeof g==="boolean"){l=g;g=arguments[1]||{};f=2}if(typeof g!=="object"&&!SPITFIRE.isFunction(g)){g={}}if(d===f){g=this;f-=1}for(;f<d;f+=1){if((m=arguments[f])!==null){for(c in m){if(m.hasOwnProperty(c)){a=g[c];b=m[c];if(g===b){continue}if(l&&b&&(SPITFIRE.isPlainObject(b)||(h=SPITFIRE.isArray(b)))){if(h){h=false;k=a&&SPITFIRE.isArray(a)?a:[]}else{k=a&&SPITFIRE.isPlainObject(a)?a:{}}g[c]=SPITFIRE.extend(l,k,b)}else{if(b!==undefined){g[c]=b}}}}}}return g};SPITFIRE.addListener=function(d,c,b,a){a=a||d;if(SPITFIRE.browser.IE){d.attachEvent("on"+c,b.context(a))}else{d.addEventListener(c,b.context(a),false)}};SPITFIRE.removeListener=function(d,c,b,a){a=a||d;if(SPITFIRE.browser.IE){d.detachEvent("on"+c,b.context(a))}else{d.removeEventListener(c,b.context(a),false)}};SPITFIRE.merge=function(d,c){if(typeof d==="undefined"){return SPITFIRE.clone(c)}if(typeof c==="undefined"){return SPITFIRE.clone(d)}var a=SPITFIRE.clone(d),b;for(b in c){if(typeof a[b]!=="undefined"){a[b]=SPITFIRE.merge(a[b],c[b])}else{a[b]=SPITFIRE.clone(c[b])}}return a};SPITFIRE.clone=function(c){if(typeof c!=="object"){return c}var a={},b;for(b in c){if(c.hasOwnProperty(b)){a[b]=SPITFIRE.clone(c[b]);a[b]._name=b}}return a};SPITFIRE.extendDOM=function(a){var b=$(a);SPITFIRE.extendChildren(b)};SPITFIRE.extendChildren=function(e){var n=e.filter("[sf-base]"),b=e.children(),h,l,a=n[0],m=a.getAttribute("sf-base"),f=m.split("."),d,g,c,k;for(h=0,l=b.length;h<l;h+=1){SPITFIRE.extendChildren($(b[h]))}if(n.length){g=window;for(d=0,c=f.length;d<c;d+=1){g=g[f[d]]}if(!g){throw new SPITFIRE.Error("base class not found")}k=new g();SPITFIRE.extend(a,k);a.init()}};SPITFIRE.trackEvent=function(b,d,a,c){var e=e||[];if(typeof b!=="undefined"&&typeof d!=="undefined"){e.push(["_trackEvent",b,d,a,c])}};SPITFIRE.trackPage=function(a){var b=b||[];if(typeof a!=="undefined"){b.push(["_trackPageview",a])}};if(!Array.indexOf){Array.prototype.indexOf=function(c){for(var b=0,a=this.length;b<a;b+=1){if(this[b]===c){return b}}return -1}}if(typeof Object.create!=="function"){Object.create=function(b){function a(){}a.prototype=b;return new a()}}Function.prototype.context=function(b){var c=this,a;a=function(){return c.apply(b,arguments)};return a};window.log=function(){log.history=log.history||[];log.history.push(arguments);if(typeof console!=="undefined"){console.log(Array.prototype.slice.call(arguments))}};SPITFIRE.Class=function(l){if(l.isExtended){return}var j,a,f,d,g,e,b,c;if(typeof l.synthesizedProperties!=="undefined"){j=function(i){return function(){return this["_"+i]}};a=function(i){return function(m){this["_"+i]=m;return this}};f=function(i){return function(){if(arguments.length>0){return this["set"+i].apply(this,arguments)}else{return this["get"+i]()}}};for(d=0,g=l.synthesizedProperties.length;d<g;d+=1){e=l.synthesizedProperties[d];b=e.charAt(0).toUpperCase()+e.slice(1);if(!("get"+b in l.prototype)){l.prototype["get"+b]=j(e)}if(!("set"+b in l.prototype)){l.prototype["set"+b]=a(e)}l.prototype[e]=f(b)}}c={};function k(o,i){var m,n,p=/callSuper/ig;if(typeof o!=="undefined"){m=SPITFIRE.clone(o);for(n in i){if(typeof m[n]!=="undefined"){if(m[n].toString().search(p)!==-1){m[n]._super=i[n]}}else{m[n]=i[n]}}}else{m=SPITFIRE.clone(i)}return m}function h(i,m){m.prototype=k(m.prototype,i.prototype);return m}(function(i){var m=l.superclass;if(m){if(m.superclass&&!m.isExtended){arguments.callee(m.superclass)}c=h(m,c)}}(l));l=h(c,l);l.prototype.callSuper=function(){var m=arguments.callee.caller,i=m._super;if(typeof m.superclass!=="undefined"){m.superclass.apply(this,arguments)}else{if(typeof i!=="undefined"){return i.apply(this,arguments)}}};l.isExtended=true};SPITFIRE.Object=function(){this.setQualifiedClassName("SPITFIRE.Object")};SPITFIRE.Object.synthesizedProperties=["qualifiedClassName"];SPITFIRE.Object.prototype={init:function(){}};SPITFIRE.Class(SPITFIRE.Object);SPITFIRE.Error=function(a){this.callSuper();this.setMessage(a);this.setName("Error");this.setQualifiedClassName("SPITFIRE.Error")};SPITFIRE.Error.superclass=SPITFIRE.Object;SPITFIRE.Error.synthesizedProperties=["message","name"];SPITFIRE.Error.prototype={toString:function(){return this.getName()+": ["+this.getQualifiedClassName()+'] "'+this.getMessage()+'"'}};SPITFIRE.Class(SPITFIRE.Error);SPITFIRE.Event=function(c,d,b,a){this.setBubbles(b||false);this.setCancelable(a||false);this.setData(d||{});this.setType(c)};SPITFIRE.Event.COMPLETE="complete";SPITFIRE.Event.CHANGE="change";SPITFIRE.Event.synthesizedProperties=["bubbles","cancelable","data","target","type"];SPITFIRE.Event.superclass=SPITFIRE.Object;SPITFIRE.Class(SPITFIRE.Event);SPITFIRE.EventDispatcher=function(){this.callSuper();this.setQualifiedClassName("SPITFIRE.EventDispatcher");this._eventListeners={}};SPITFIRE.EventDispatcher.superclass=SPITFIRE.Object;SPITFIRE.EventDispatcher.prototype={bind:function(b,a){if(!this._eventListeners[b]){this._eventListeners[b]=[]}this._eventListeners[b].push(a)},unbind:function(d,c){if(typeof c==="undefined"){this._eventListeners[d]=[];return}for(var b=0,a=this._eventListeners[d].length;b<a;b+=1){if(this._eventListeners[d][b]===c){this._eventListeners[d].splice(b,1)}}},trigger:function(d){d.setTarget(this);var c=[d],b,a;if(this._eventListeners[d.getType()]){for(b=0,a=this._eventListeners[d.getType()].length;b<a;b+=1){this._eventListeners[d.getType()][b].apply(this,c)}}}};SPITFIRE.Class(SPITFIRE.EventDispatcher);SPITFIRE.DisplayObject=function(a){this.callSuper();this.setQualifiedClassName("SPITFIRE.DisplayObject");this._scaleX=1;this._scaleY=1;this._scale=1;this._placeholderProperties=[];this._z=1;this._$this=a;this._isCentered=false};SPITFIRE.DisplayObject.superclass=SPITFIRE.EventDispatcher;SPITFIRE.DisplayObject.synthesizedProperties=["$this","l","t","w","h","scaleX","scaleY","scale","rect","z","isCentered"];SPITFIRE.DisplayObject.prototype={setL:function(a){this._$this.css("left",a)},getL:function(){var a=(this.style&&this.style.left)?parseFloat(this.style.left):parseFloat(this._$this.css("left"));return a||0},setT:function(a){this._$this.css("top",a)},getT:function(){var a=(this.style&&this.style.top)?parseFloat(this.style.top):parseFloat(this._$this.css("top"));return a||0},getW:function(){return(this._w)?this._w*this._scaleX:this._$this.width()},setW:function(a){this._w=a||270;this._$this.width(this._w*this._scaleX);if(this._isCentered){this.setL(~~(-this._$this.width()*0.5))}},getH:function(){return(this._h)?this._h*this._scaleY:this._$this.height()},setH:function(a){this._h=a;this._$this.height(this._h*this._scaleY);if(this._isCentered){this.setT(~~(-this._$this.height()*0.5))}},getScale:function(){return(this._scaleX===this._scaleY)?this._scaleX:undefined},setScale:function(a){this._scale=a;this.setScaleX(a);this.setScaleY(a)},setScaleX:function(a){this._scaleX=a;this.setW(this._w)},setScaleY:function(a){this._scaleY=a;this.setH(this._h)},getRect:function(){return new SPITFIRE.Rectangle(this.getL(),this.getT(),this.getW(),this.getH())},setRect:function(a){this.setL(a.getX());this.setT(a.getY());this.setW(a.getWidth());this.setH(a.getHeight())},setZ:function(a){this._z=a>>0;this._$this.css("z-index",this._z)},animate:function(c,b){var d,a;for(d in c){if(SPITFIRE.isSynthesizedProperty(d,SPITFIRE.DisplayObject)){a=d+"AnimationValue";c[a]=c[d];delete c[d];this[a]=this[d]();this._placeholderProperties.push(a)}}if(b.step){this.providedAnimationStep=b.step}b.step=this.animationStep.context(this);if(b.complete){this.providedAnimationComplete=b.complete}b.complete=this.animationComplete.context(this);this._$this.animate(c,b)},animationStep:function(a,b){var c=/AnimationValue/;if(b.prop.search(c)!==-1){this[b.prop.replace(c,"")](a)}if(this.providedAnimationStep){this.providedAnimationStep(a,b)}},animationComplete:function(){if(this.providedAnimationComplete){this.providedAnimationComplete()}delete this.providedAnimationComplete;delete this.providedAnimationStep;while(this._placeholderProperties.length>0){delete this[this._placeholderProperties[0]];this._placeholderProperties.shift()}},destroy:function(){this._$this=null}};SPITFIRE.Class(SPITFIRE.DisplayObject);SPITFIRE.Task=function(){this.callSuper();this.setQualifiedClassName("SPITFIRE.Task");this.setProgress(0)};SPITFIRE.Task.superclass=SPITFIRE.EventDispatcher;SPITFIRE.Task.synthesizedProperties=["progress","progressive","name","debug"];SPITFIRE.Task.prototype={start:function(){this.setProgress(0)},complete:function(){this.setProgress(1);this.trigger(new SPITFIRE.Event(SPITFIRE.Event.COMPLETE))},toString:function(){return"["+this.getQualifiedClassName()+" name="+this.getName()+"]"}};SPITFIRE.Class(SPITFIRE.Task);SPITFIRE.TaskManager=function(){this._progressiveTasks=[];this._createdTasks=[];this._tasks=[];this.callSuper();this.qualifiedClassName("SPITFIRE.TaskManager")};SPITFIRE.TaskManager.superclass=SPITFIRE.Task;SPITFIRE.TaskManager.synthesizedProperties=["tasks"];SPITFIRE.TaskManager.prototype={setTasks:function(c){var b,a;for(b=0,a=this._tasks.length;b<a;b+=1){this.removeTask(this.tasks()[b])}this._tasks=[];for(b=0,a=c.length;b<a;b+=1){this.addTask(c[b])}},getProgress:function(){var d=0,c,a,b;for(c=0,a=this._progressiveTasks.length;c<a;c+=1){b=this._progressiveTasks[c];d+=b.progress}return d/Math.max(this._progressiveTasks.length,1)},setProgress:function(c){var b,a;for(b=0,a=this._progressiveTasks.length;b<a;b+=1){this._progressiveTasks[b].progress(c)}},setDebug:function(c){this.callSuper(c);var b,a;for(b=0,a=this.tasks().length;b<a;b+=1){this.tasks()[b].debug(c)}},addTask:function(a){if(a){this._tasks.push(a);if(a.progressive()){this._progressiveTasks.push(a)}if(this.debug()){a.debug(this.debug())}this.setProgressive()}return a},addTaskAt:function(a,b){if(a){if(a.progressive()){this._progressiveTasks.push(a);this.progressive(true)}this.tasks().splice(b,0,a);if(this.debug()){a.debug(this.debug())}this.setProgressive()}return a},contains:function(a){return this.tasks().indexOf(a)!==-1},getTaskAt:function(a){return this.tasks()[a]},getTaskByName:function(c){var e,d,a,b;for(d=0,a=this.tasks().length;d<a;d+=1){b=this.tasks()[d];if(b.name()===c){e=b;break}}return e},getTaskIndex:function(a){if(!this.contains(a)){throw new SPITFIRE.Error("The supplied task must be a child of the caller.")}return this.tasks().indexOf(a)},removeTask:function(a){if(!this.contains(a)){throw new SPITFIRE.Error("The supplied task must be a child of the caller.")}var b=this.getTaskIndex(a);if(b!==-1){this.removeTaskAt(b)}this.setProgressive();return a},removeTaskAt:function(c){var b=this.getTaskAt(c),a;this.tasks().splice(c,1);a=this._progressiveTasks.indexOf(b);if(a!==-1){this._progressiveTasks.splice(a,1)}this.setProgressive();return b},setTaskIndex:function(a,b){if(!this.contains(a)){throw new SPITFIRE.Error("The supplied task must be a child of the caller.")}var c=this.getTaskIndex(a);this.tasks().splice(b,0,this.tasks()[c]);this.tasks().splice(c,1)},swapTasksAt:function(c,b){var a=this.tasks()[c];this.tasks()[c]=this.tasks()[b];this.tasks()[b]=a},setProgressive:function(){this._progressive=(this._progressiveTasks.length>0)},toString:function(){return"["+this.qualifiedClassName()+"]"}};SPITFIRE.Class(SPITFIRE.TaskManager);SPITFIRE.State=function(a){this.callSuper();this.setName(a);this._children=[];this._selected=false;this._debug=false;this.setQualifiedClassName("SPITFIRE.State")};SPITFIRE.State.superclass=SPITFIRE.EventDispatcher;SPITFIRE.State.synthesizedProperties=["root","debug","children","stateManager","parent","name","title","description","defaultChild","selectedChild","activatedChild","selectedChildIndex","selected","index","stateLocation","selectable","pageViewName","numChildren","transitionIn","transitionOut","loadIn","loadOut","activated","childClass"];SPITFIRE.State.prototype={setRoot:function(c){this._root=c;for(var b=0,a=this._children.length;b<a;b+=1){this._children[b].setRoot(this._root)}},setStateManager:function(c){this._stateManager=c;for(var b=0,a=this._children.length;b<a;b+=1){this._children[b].setStateManager(this.stateManager())}},setChildren:function(c){for(var b=0,a=this._children.length;b<a;b+=1){this.removeChild(this._children[b])}this._children=[];for(b=0,a=c.length;b<a;b+=1){this.addChild(c[b])}},setSelectedChild:function(a){if(!this.contains(a)){throw new SPITFIRE.Error("The supplied child must be a child of the caller.")}this._selectedChild=a},getActivatedChild:function(){var c,b,a,d;for(b=0,a=this._children.length;b<a;b+=1){d=this._children[b];if(d.activated){c=d;break}}return c},getNumChildren:function(){return this._children.length},getSelectedChildIndex:function(){var a;if(this._selectedChild){a=this.getChildIndex(this._selectedChild)}return a},setSelectedChildIndex:function(a){var b=this.getChildAt(a);this.setSelectedChild(b)},setSelected:function(a){if(a!==this._selected){this._selected=a;this.trigger(new SPITFIRE.StateEvent(SPITFIRE.StateEvent.STATE_CHANGE))}},getIndex:function(){return this.getParent().getChildIndex(this)},getStateLocation:function(){var d=[],f=this,c="",e,a,b;while(f){d.push(f);f=f.getParent()}d.reverse();for(e=0,a=d.length;e<a;e+=1){b=d[e];c+=b.getName();if(b!==d[a-1]){c+="/"}}return c},childChangeHandler:function(a){var b=a.getTarget();if(b.getSelected()){this._selectedChild=b}else{if(b===this._selectedChild){this._selectedChild=undefined}}this.trigger(new SPITFIRE.StateEvent(SPITFIRE.StateEvent.CHILD_STATE_CHANGE))},addChild:function(a){a.setParent(this);a.setStateManager(this.getStateManager());a.setRoot(this._root);a.setDebug(this._debug);this._children.push(a);a.bind(SPITFIRE.StateEvent.STATE_CHANGE,this.childChangeHandler.context(this))},addChildAt:function(b,a){b.setParent(this);b.setStateManager(this.getStateManager());b.setRoot(this._root);this._children.splice(a,0,b);b.bind(SPITFIRE.StateEvent.STATE_CHANGE,this.childChangeHandler.context(this));return b},contains:function(a){return this._children.indexOf(a)!==-1},getChildAt:function(a){return this._children[a]},getChildByName:function(b){var d,c,a,e;for(c=0,a=this._children.length;c<a;c+=1){e=this._children[c];if(e.getName()===b){d=e;break}}return d},getChildIndex:function(a){if(!this.contains(a)){throw new SPITFIRE.Error("The supplied child must be a child of the caller.")}return this._children.indexOf(a)},removeChild:function(b){if(!this.contains(b)){throw new SPITFIRE.Error("The supplied child must be a child of the caller.")}var a=this.getChildIndex(b);if(a!==-1){b=this.removeChildAt(a)}return b},removeChildAt:function(a){var b=this.getChildAt(a);b.unbind(SPITFIRE.StateEvent.STATE_CHANGE,this.childChangeHandler.context(this));this._children.splice(a,1);return b},setChildIndex:function(c,a){if(!this.contains(c)){throw new SPITFIRE.Error("The supplied child must be a child of the caller.")}var b=this.getChildIndex(c);this._children.splice(a,0,this._children[b]);this._children.splice(b,1)},swapChildrenAt:function(c,b){var a=this._children[c];this._children[c]=this._children[b];this._children[b]=a},setSelectedChildByName:function(b){var d,c,a,e;for(c=0,a=this._children.length;c<a;c+=1){e=this._children[c];if(e.getName()===b){d=e;break}}if(d){this.setSelectedChild(d)}else{throw new SPITFIRE.Error("The supplied child must be a child of the caller.")}},browse:function(){var a=this.getStateLocation()+this.findDefaultStates();this.stateManager().setLocation(a)},findDefaultStates:function(){var d=[],c=this.getChildByName(this.getDefaultChild()),b="",e,a,f;while(c){d.push(c);c=c.getChildByName(c.getDefaultChild())}for(e=0,a=d.length;e<a;e+=1){if(e===0){b+="/"}f=d[e];b+=f.getName();if(e<d.length-1){b+="/"}}return b},browsePreviousSibling:function(){var a=this.index-1;if(a<0){a=this.getParent().getChildren().length-1}this.getParent().getChildAt(a).browse()},browseNextSibling:function(){var a=this.index+1;if(a>this.getParent().getChildren().length-1){a=0}this.getParent().getChildAt(a).browse()},browsePreviousChild:function(){var a=this.getSelectedChildIndex()-1;if(a<0){a=this._children.length-1}this.getChildAt(a).browse()},browseNextChild:function(){var a=this.getSelectedChildIndex()+1;if(a>this._children.length-1){a=0}this.getChildAt(a).browse()},getChildFromPath:function(e){var c=this,b,a,d;if(e.length>0){d=e.split("/");for(b=0,a=d.length;b<a;b+=1){c=c.getChildByName(d[b])}}return c},createChildByName:function(b){if(!this.childClass()){throw new SPITFIRE.Error(this+": no child class defined")}var a=new this._childClass();a.setName(b);this.addChild(a);return a},toString:function(){return"[State name="+this.getName()+" title="+this.getTitle()+" className="+this.getQualifiedClassName()+" defaultChild="+this.getDefaultChild()+"]"}};SPITFIRE.Class(SPITFIRE.State);SPITFIRE.ModelEvent=function(c,d,b,a){this.callSuper(c,d,b,a)};SPITFIRE.ModelEvent.DATA_UPDATE="dataUpdate";SPITFIRE.ModelEvent.superclass=SPITFIRE.Event;SPITFIRE.Class(SPITFIRE.ModelEvent);SPITFIRE.StateEvent=function(c,d,b,a){this.callSuper(c,d,b,a)};SPITFIRE.StateEvent.CHILD_STATE_CHANGE="childStateChange";SPITFIRE.StateEvent.STATE_CHANGE="stateChange";SPITFIRE.StateEvent.STATE_ACTIVATED="stateActivated";SPITFIRE.StateEvent.superclass=SPITFIRE.Event;SPITFIRE.Class(SPITFIRE.StateEvent);SPITFIRE.StateManagerEvent=function(c,e,b,a,d){this.callSuper(c,e,b,a);this.setState(d);this.setQualifiedClassName("SPITFIRE.StateManagerEvent")};SPITFIRE.StateManagerEvent.LOAD_IN_START="loadInStart";SPITFIRE.StateManagerEvent.LOAD_IN_COMPLETE="loadInComplete";SPITFIRE.StateManagerEvent.TRANSITION_IN_START="transitionInStart";SPITFIRE.StateManagerEvent.TRANSITION_IN_COMPLETE="transitionInComplete";SPITFIRE.StateManagerEvent.LOAD_OUT_START="loadOutStart";SPITFIRE.StateManagerEvent.LOAD_OUT_COMPLETE="loadOutComplete";SPITFIRE.StateManagerEvent.TRANSITION_OUT_START="transitionOutStart";SPITFIRE.StateManagerEvent.TRANSITION_OUT_COMPLETE="transitionOutComplete";SPITFIRE.StateManagerEvent.TRANSITION_IN_STATE_COMPLETE="transitionInStateComplete";SPITFIRE.StateManagerEvent.TRANSITION_OUT_STATE_COMPLETE="transitionOutStateComplete";SPITFIRE.StateManagerEvent.LOAD_IN_STATE_COMPLETE="loadInStateComplete";SPITFIRE.StateManagerEvent.LOAD_OUT_STATE_COMPLETE="loadOutStateComplete";SPITFIRE.StateManagerEvent.DEEPLINK="deeplink";SPITFIRE.StateManagerEvent.superclass=SPITFIRE.Event;SPITFIRE.StateManagerEvent.synthesizedProperties=["state"];SPITFIRE.Class(SPITFIRE.StateManagerEvent);SPITFIRE.TimerEvent=function(c,d,b,a){this.callSuper(c,d,b,a);this.setQualifiedClassName("SPITFIRE.TimerEvent")};SPITFIRE.TimerEvent.TIMER="timer";SPITFIRE.TimerEvent.TIMER_COMPLETE="timerComplete";SPITFIRE.TimerEvent.superclass=SPITFIRE.Event;SPITFIRE.Class(SPITFIRE.TimerEvent);SPITFIRE.Point=function(a,b){this.callSuper();this.setQualifiedClassName("SPITFIRE.Point");this.x=a;this.y=b};SPITFIRE.Point.superclass=SPITFIRE.Object;SPITFIRE.Point.prototype={toString:function(){return"["+this.getQualifiedClassName()+"] x:"+this.x+" y:"+this.y}};SPITFIRE.Class(SPITFIRE.Point);SPITFIRE.Rectangle=function(b,d,c,a){this.callSuper();this.qualifiedClassName("SPITFIRE.Rectangle");this.setX(b);this.setY(d);this.setWidth(c);this.setHeight(a)};SPITFIRE.Rectangle.superclass=SPITFIRE.Object;SPITFIRE.Rectangle.synthesizedProperties=["x","y","width","height","top","left","right","bottom","size","bottomRight","topLeft"];SPITFIRE.Rectangle.prototype={setTop:function(a){throw new SPITFIRE.Error("read-only: cannot set top property")},getTop:function(){return this.getY()},setLeft:function(a){throw new SPITFIRE.Error("read-only: cannot set left property")},getLeft:function(){return this.getX()},setRight:function(a){throw new SPITFIRE.Error("read-only: cannot set right property")},getRight:function(){return this.getX()+this.getWidth()},setBottom:function(a){throw new SPITFIRE.Error("read-only: cannot set bottom property")},getBottom:function(){return this.getY()+this.getHeight()},setSize:function(a){throw new SPITFIRE.Error("read-only: cannot set size property")},getSize:function(){return new SPITFIRE.Point(this.getWidth(),this.getHeight())},setTopLeft:function(a){throw new SPITFIRE.Error("read-only: cannot set topLeft property")},getTopLeft:function(){return new SPITFIRE.Point(this.getTop(),this.getLeft())},setBottomRight:function(a){throw new SPITFIRE.Error("read-only: cannot set bottomRight property")},getBottomRight:function(){return new SPITFIRE.Point(this.getBottom(),this.getRight())},clone:function(){return new SPITFIRE.Rectangle(this.getX(),this.getY(),this.getWidth(),this.getHeight())},toString:function(){return"["+this.getQualifiedClassName()+"]"}};SPITFIRE.Class(SPITFIRE.Rectangle);SPITFIRE.Percent=function(a,b){this.callSuper();a=b||0;b=b||true;if(b){this.setDecimalPercentage(a)}else{this.setPercentage(a)}};SPITFIRE.Percent.superclass=SPITFIRE.Object;SPITFIRE.synthesizedProperties=["percentage","decimalPercentage"];SPITFIRE.prototype={getPercentage:function(){return 100*this._percent},setPercentage:function(a){this._percent=a*0.01},getDecimalPercentage:function(){return this._percent},setDecimalPercentage:function(a){this._percent=a},equals:function(a){return this.getDecimalPercentage()===a.getDecimalPercentage()},clone:function(){return new SPITFIRE.Percent(this.getDecimalPercentage())},valueOf:function(){return this.getDecimalPercentage()},toString:function(){return this.getDecimalPercentage().toString()}};SPITFIRE.Class(SPITFIRE.Percent);SPITFIRE.Model=function(){this.callSuper();this.setQualifiedClassName("SPITFIRE.Model")};SPITFIRE.Model.superclass=SPITFIRE.EventDispatcher;SPITFIRE.Model.synthesizedProperties=["data"];SPITFIRE.Model.prototype={setData:function(a){this._data=a;this.trigger(new SPITFIRE.ModelEvent(SPITFIRE.ModelEvent.DATA_UPDATE))},toString:function(){return"["+this.getQualifiedClassName()+"]"}};SPITFIRE.Class(SPITFIRE.Model);SPITFIRE.DisplayState=function(d,c,b){this.callSuper(d);this.qualifiedClassName("SPITFIRE.DisplayState");this.cache=b||[];var a={id:"",trackingPageId:"",assets:{view:"",stylesheets:[],images:[]}},e=c||a;this.setConfig(e);this.stylesheets([]);this.images([]);this._addedDOMAssets=[];this._isCached=false};SPITFIRE.DisplayState.superclass=SPITFIRE.State;SPITFIRE.DisplayState.synthesizedProperties=["view","stylesheets","images","config","isCached"];SPITFIRE.DisplayState.prototype={getLoadIn:function(){if(this.getIsCached()){return undefined}var c=new SPITFIRE.SequentialTask(),e,g,b,a,f,j=this.config().assets.view,d=this.config().assets.stylesheets,h=this.config().assets.images;if(j&&j!==""&&!this.checkIsCached(j)){this.cache.push(j);this.view(new SPITFIRE.JQueryAjaxTask(j));c.addTask(this.view())}if(d.length>0){for(e=0,g=d.length;e<g;e+=1){a=d[e];if(this.checkIsCached(a)){continue}this.cache.push(a);b=new SPITFIRE.JQueryAjaxTask(a);this.stylesheets().push(b);c.addTask(b)}}if(h.length>0){for(e=0,g=h.length;e<g;e+=1){f=h[e];if(this.checkIsCached(f)){continue}this.cache.push(f);b=new SPITFIRE.JQueryAjaxTask(f);this.images().push(b);c.addTask(b)}}c.addTask(new SPITFIRE.FunctionTask(this,this.addDOMAssets));return c},getTransitionIn:function(){return new SPITFIRE.FunctionTask(this,this.trackPage)},getTransitionOut:function(){return new SPITFIRE.FunctionTask(this,this.cleanUp)},addDOMAssets:function(){this.setIsCached(true);var c,a,f,d,e,b=document.getElementsByTagName("head")[0];if(this.stylesheets().length>0){for(c=0,a=this.stylesheets().length;c<a;c+=1){d=document.createElement("style");d.type="text/css";e=document.createTextNode(this.stylesheets()[c].content());if(d.styleSheet){d.styleSheet.cssText=e.nodeValue}else{d.appendChild(e)}b.appendChild(d);this._addedDOMAssets.push(d)}}if(this.view()){f=$(this.view().content()).appendTo("body");this._addedDOMAssets.push(f)}},checkIsCached:function(c){var b,a;for(b=0,a=this.cache.length;b<a;b+=1){if(this.cache[b]===c){return true}}return false},removeDOMAssets:function(){while(this._addedDOMAssets.length>0){var a=this._addedDOMAssets[0];if(typeof a.remove==="function"){a.remove()}else{}this._addedDOMAssets.shift()}},cleanUp:function(){},trackPage:function(){var a=this.getConfig().trackingPageId;if(typeof a!=="undefined"&&a!==""){SPITFIRE.trackPage(a)}},toString:function(){return"["+this.qualifiedClassName()+"]"}};SPITFIRE.Class(SPITFIRE.DisplayState);SPITFIRE.Redirect=function(a,b){this.callSuper();this.setQualifiedClassName("SPITFIRE.Redirect");this.setLocation(a);this.setNewLocation(b)};SPITFIRE.Redirect.superclass=SPITFIRE.Object;SPITFIRE.Redirect.synthesizedProperties=["location","newLocation"];SPITFIRE.Class(SPITFIRE.Redirect);SPITFIRE.StateManager=function(b,a){this.callSuper();this.setRoot(a);this.setQualifiedClassName("SPITFIRE.StateManager");this.setName(b||this.getQualifiedClassName()+~~(Math.random()*100000));this.setPageViewType(SPITFIRE.StateManager.PAGE_VIEW_LOCATION);this._progressTimer=new SPITFIRE.Timer(33);this._progressTimer.bind(SPITFIRE.TimerEvent.TIMER,this.taskManagerProgressHandler.context(this));this._transitionInPath=undefined;this._transitionWasInterrupted=undefined;this._isInTransition=undefined;this._transitions=undefined;this._currentTransition=undefined;this._redirects=[]};SPITFIRE.StateManager.PAGE_VIEW_LOCATION="pageViewLocation";SPITFIRE.StateManager.PAGE_VIEW_NAME="pageViewName";SPITFIRE.StateManager.superclass=SPITFIRE.EventDispatcher;SPITFIRE.StateManager.synthesizedProperties=["root","deepLinking","tree","startLocation","location","activeStates","taskManager","preloader","selectedStates","debug","trackViewPages","pageViewType","redirects","name"];SPITFIRE.StateManager.prototype={setDeepLinking:function(a){this._deepLinking=a;if(this.getDeepLinking()){this.getDeepLinking().change(this.deepLinkingChangeHandler.context(this))}},setTree:function(a){this._tree=a;a.setStateManager(this);a.setRoot(this.root());a.setDebug(this._debug)},getLocation:function(){var c=this.getSelectedStates(),e="",d,a,b;for(d=0,a=c.length;d<a;d+=1){b=c[d];e+=b.getName();if(b!==c[c.length-1]){e+="/"}}return e},setLocation:function(c){var e,d,a,b;if(this.getDeepLinking()){e=c.split("/");e.shift();d="/"+e.join("/");this.getDeepLinking().value(d)}else{a=c.split("/");a.shift();b=this.getTree();if(a.length>0){b=b.getChildFromPath(a.join("/"))}this._transitionInPath=b.getStateLocation();this.checkIfInTransition()}},getSelectedStates:function(){var a=[],b;if(this.getTree().getSelected()){b=this.getTree()}while(b){a.push(b);b=b.getSelectedChild()}return a},deepLinkingChangeHandler:function(a){var b=this.getDeepLinking().value();if(b===""||b==="/"){this._transitionInPath=this.getTree().getStateLocation()}else{this._transitionInPath=this.getTree().getName()+b}this.checkIfInTransition()},taskManagerProgressHandler:function(b){var a=this.getTaskManager().getProgress();if(this.getDebug()){log(this.getName()+" totalProgress = "+a)}if(isNaN(a)){a=0}if(typeof this.getPreloader()!=="undefined"){this.getPreloader().setProgress(a)}},transitionInCompleteHandler:function(a){if(this.getTrackPageViews()){var b;switch(this.getPageViewType()){case SPITFIRE.StateManager.PAGE_VIEW_LOCATION:b=this.getLocation();break;case SPITFIRE.StateManager.PAGE_VIEW_NAME:b=this.getLocation();break}}},taskManagerCompleteHandler:function(a){this.getTaskManager().unbind(SPITFIRE.Event.COMPLETE,this.taskManagerCompleteHandler.context(this));if(this.getTaskManager().getProgressive()){this.taskManagerProgressHandler();this._progressTimer.stop()}this.trigger(new SPITFIRE.Event(this._currentTransition.transitionName()+"Complete"));this._currentTransition=null;if(this._transitions.length>0){this.startTransition()}else{this._transitions=null;this._isInTransition=false;if(this._transitionWasInterrupted){this.startTransitions()}}},init:function(){if(this.getDeepLinking()){if(this.getDeepLinking().value()!=="/"){this.deepLinkingChangeHandler()}else{if(this.getStartLocation()){this.location(this.getStartLocation())}else{this._transitionInPath=this.getTree().getStateLocation();this.checkIfInTransition()}}}else{if(this.getStartLocation()){this.location(this.getStartLocation())}else{this._transitionInPath=this.getTree().getStateLocation();this.checkIfInTransition()}}},checkIfInTransition:function(){if(this._isInTransition){this._transitionWasInterrupted=true}else{this.startTransitions()}},startTransitions:function(){this._transitionWasInterrupted=false;this._isInTransition=true;this._transitionInPath=this.checkRedirect(this._transitionInPath);var c=this._transitionInPath.split("/"),j=[],b=[],k=[],d=0,e,g,h,l,f,a;if(this.getLocation().length>0){j=this.getLocation().split("/")}for(e=0,g=j.length;e<g;e+=1){h=j.slice(0,e+1);l=h.join("/");f=c.slice(0,e+1);a=f.join("/");if(l===a){d+=1}}this._transitions=[];for(e=j.length-1;e>=d;e-=1){h=j.slice(0,e+1);b.push(h.join("/"))}this.deactivateStates(b);this._transitions.push(new SPITFIRE.TransitionProperties(b.slice(),"loadOut",false));this._transitions.push(new SPITFIRE.TransitionProperties(b.slice(),"transitionOut",false));for(e=d,g=c.length;e<g;e+=1){f=c.slice(0,e+1);k.push(f.join("/"))}k=this.activateStates(k);if(k.length===0){k=this.checkForDefaultStates(this._transitionInPath)}this._transitions.push(new SPITFIRE.TransitionProperties(k.slice(),"loadIn",false));this._transitions.push(new SPITFIRE.TransitionProperties(k.slice(),"transitionIn",false));this.startTransition()},deactivateStates:function(c){var g,h,k,d,a,f,e,b;for(g=0,h=c.length;g<h;g+=1){k=c[g];d=k.split("/");d.shift();a=this.getTree();if(d.length>0){for(f=0,e=d.length;f<e;f+=1){b=a;a=b.getChildByName(d[f])}}a.activated(false)}},activateStates:function(c){var e=[],h,k,m,d,a,g,f,b,l;this._activeStates=[];for(h=0,k=c.length;h<k;h+=1){m=c[h];d=m.split("/");d.shift();a=this.getTree();if(d.length>0){for(g=0,f=d.length;g<f;g+=1){b=a;a=b.getChildByName(d[g]);if(!a){a=b.createChildByName(d[g])}}}a.setActivated(true);this.getActiveStates().push(a);e.push(a.getStateLocation());if(a.getStateLocation()===c[c.length-1]){l=a.getChildByName(a.defaultChild());while(l){l.setActivated(true);this.getActiveStates().push(l);e.push(l.getStateLocation());l=l.getChildByName(l.getDefaultChild())}}}return e},checkForDefaultStates:function(g){var h=[],f=g.split("/"),e=this.getTree(),c,a,d,b;f.shift();if(f.length>0){for(c=0,a=f.length;c<a;c+=1){d=e;e=d.getChildByName(f[c])}}b=e.getChildByName(e.defaultChild);while(b){b.setActivated(true);this.getActiveStates().push(b);h.push(b.getStateLocation());b=b.getChildByName(b.getDefaultChild())}return h},startTransition:function(){this._currentTransition=this._transitions.shift();this.trigger(new SPITFIRE.Event(this._currentTransition.getTransitionName()+"Start"));this.setTaskManager(new SPITFIRE.SequentialTask());this.getTaskManager().setName(this._currentTransition.getTransitionName());if(this.getDebug()){this.getTaskManager().setDebug(this.getDebug())}this.getTaskManager().bind(SPITFIRE.Event.COMPLETE,this.taskManagerCompleteHandler.context(this));var d,a,g,f,e,c,b;for(d=0,a=this._currentTransition.getLocations().length;d<a;d+=1){g=this._currentTransition.getLocations()[d];f=g.split("/");f.shift();e=this.getTree();if(f.length>0){e=e.getChildFromPath(f.join("/"))}c=e[this._currentTransition.getTransitionName()]();if(c){this.getTaskManager().addTask(c)}b=false;if(this._currentTransition.getTransitionName()==="transitionIn"){b=true}if(this._currentTransition.getTransitionName()==="transitionOut"){b=false}this.getTaskManager().addTask(new SPITFIRE.PropertyTask(e,"selected",b))}if(this.getTaskManager().getProgress()===1){this.getTaskManager().getProgressive(false)}if(this.getTaskManager().getProgressive()){if(this.getPreloader()){this.getTaskManager().addTaskAt(new SPITFIRE.PropertyTask(this.getPreloader(),"progress",0),0);this.getTaskManager().addTaskAt(this.getPreloader().getTransitionIn(),1);this.getTaskManager().addTask(this.getPreloader().getTransitionOut())}this.getTaskManager().setProgress(0);this._progressTimer.start()}this.getTaskManager().start()},addRedirect:function(a,b){this.removeRedirect(a);this.redirects.push(new SPITFIRE.Redirect(a,b))},removeRedirect:function(b){var d=[],c,a,e;for(c=0,a=this.getRedirects().length;c<a;c+=1){e=this.getRedirects()[c];if(e.getLocation()!==b){d.push(e)}}this.setRedirects(d)},checkRedirect:function(c){var b,a,d;for(b=0,a=this.getRedirects().length;b<a;b+=1){d=this.getRedirects()[b];if(c===d.getLocation()){c=d.getNewLocation()}}return c},toString:function(){return"[StateManager name="+this.getName()+" className = "+this.getQualifiedClassName()+"]"}};SPITFIRE.Class(SPITFIRE.StateManager);SPITFIRE.TransitionProperties=function(a,b,c){this.callSuper();this.locations(a);this.transitionName(b);this.showPreloader(c)};SPITFIRE.TransitionProperties.superclass=SPITFIRE.Object;SPITFIRE.TransitionProperties.synthesizedProperties=["locations","transitionName","showPreloader","currentState"];SPITFIRE.TransitionProperties.prototype={toString:function(){return this.transitionName()}};SPITFIRE.Class(SPITFIRE.TransitionProperties);SPITFIRE.EventTask=function(b,a,c){this.callSuper();this.qualifiedClassName("SPITFIRE.EventTask");this.target(b);this.eventName(a||"complete");this.method(c)};SPITFIRE.EventTask.superclass=SPITFIRE.Task;SPITFIRE.EventTask.synthesizedProperties=["target","eventName","method"];SPITFIRE.EventTask.prototype={eventCompleteHandler:function(a){this.complete()},start:function(){this._target.bind(this._eventName,this.eventCompleteHandler.context(this));if(typeof this._method!=="undefined"){this._method.apply(this._target)}},toString:function(){return"["+this.qualifiedClassName()+" target="+this.target()+" eventName="+this.eventName()+" method="+this.method()+"]"}};SPITFIRE.Class(SPITFIRE.EventTask);SPITFIRE.FunctionTask=function(c,d){this.callSuper();this.setQualifiedClassName("SPITFIRE.FunctionTask");this.setMethod(d);this.setContext(c);this.setArgs([]);var b,a;for(b=2,a=arguments.length;b<a;b+=1){this.getArgs().push(arguments[b])}};SPITFIRE.FunctionTask.superclass=SPITFIRE.Task;SPITFIRE.FunctionTask.synthesizedProperties=["context","method","args"];SPITFIRE.FunctionTask.prototype={start:function(){this.getMethod().apply(this.getContext(),this.getArgs());this.complete()},toString:function(){return"["+this.getQualifiedClassName()+"] function:"+this.getMethod()._name}};SPITFIRE.Class(SPITFIRE.FunctionTask);SPITFIRE.JQueryAjaxTask=function(a,b){this.callSuper();this.qualifiedClassName("SPITFIRE.JQueryAjaxTask");this.url(a);this.settings(b)};SPITFIRE.JQueryAjaxTask.superclass=SPITFIRE.Task;SPITFIRE.JQueryAjaxTask.synthesizedProperties=["url","settings","content"];SPITFIRE.JQueryAjaxTask.prototype={ajaxSuccessHandler:function(b,c,a){this.content(b);this.complete()},ajaxErrorHandler:function(a,c,b){if(this.debug()){log(this+" Error: could not load this file. textStatus="+c+" errorThrown="+b)}this.complete()},ajaxComplete:function(a,b){if(this.debug()){log(this+" Complete: textStatus="+b)}},start:function(){$.ajax(this.url(),this.settings()).success(this.ajaxSuccessHandler.context(this)).error(this.ajaxErrorHandler.context(this)).complete(this.ajaxComplete.context(this))},toString:function(){return"["+this.qualifiedClassName()+"] url:"+this.url()}};SPITFIRE.Class(SPITFIRE.JQueryAjaxTask);SPITFIRE.JQueryEffectTask=function(c,b){this.callSuper();this.qualifiedClassName("SPITFIRE.JQueryEffectTask");var a=SPITFIRE.slice(arguments,2,arguments.length-1);if(!SPITFIRE.isFunction(c[b])){throw new SPITFIRE.Error("target does not support this effect")}this.target(c);this.effect(b);this.args(a)};SPITFIRE.JQueryEffectTask.superclass=SPITFIRE.Task;SPITFIRE.JQueryEffectTask.synthesizedProperties=["target","effect","args"];SPITFIRE.JQueryEffectTask.prototype={effectCompleteHandler:function(){this.complete()},start:function(){this.args().push($.proxy(this.effectCompleteHandler,this));this.target()[this.effect()].apply(this.target(),this.args())},toString:function(){return"["+this.qualifiedClassName()+"]"}};SPITFIRE.Class(SPITFIRE.JQueryEffectTask);SPITFIRE.JQueryGetJSONTask=function(a,b){this.callSuper();this.qualifiedClassName("SPITFIRE.JQueryGetJSONTask");this.url(a);this.data(b)};SPITFIRE.JQueryGetJSONTask.superclass=SPITFIRE.Task;SPITFIRE.JQueryGetJSONTask.synthesizedProperties=["url","data","content"];SPITFIRE.JQueryGetJSONTask.prototype={jsonHandler:function(a,b){if(b==="success"){this.content(a)}this.complete()},start:function(){$.getJSON(this.url(),this.jsonHandler.context(this))},toString:function(){return"["+this.qualifiedClassName()+"]"}};SPITFIRE.Class(SPITFIRE.JQueryGetJSONTask);SPITFIRE.JQueryImageLoaderTask=function(a){this.callSuper();this.qualifiedClassName("SPITFIRE.JQueryImageLoaderTask");this.url(a);this.content(new Image());this.$content($(this.content()));this.$content().load(this.completeHandler.context(this)).error(this.errorHandler.context(this))};SPITFIRE.JQueryImageLoaderTask.superclass=SPITFIRE.Task;SPITFIRE.JQueryImageLoaderTask.synthesizedProperties=["url","content","$content"];SPITFIRE.JQueryImageLoaderTask.prototype={completeHandler:function(){this.complete()},errorHandler:function(){if(this.debug()){log(this+" Error: could not load this file.")}this.complete()},start:function(){this.$content().attr("src",this.url())},toString:function(){return"["+this.qualifiedClassName()+" url="+this.url()+"]"}};SPITFIRE.Class(SPITFIRE.JQueryImageLoaderTask);SPITFIRE.JQueryLoadTask=function(b,a){this.callSuper();this.qualifiedClassName("SPITFIRE.JQueryLoadTask");if(!b){throw new SPITFIRE.Error("a valid url must be specified")}this.url(b);this.$target(a||$("body"))};SPITFIRE.JQueryLoadTask.superclass=SPITFIRE.Task;SPITFIRE.JQueryLoadTask.synthesizedProperties=["url","$target"];SPITFIRE.JQueryLoadTask.prototype={loadHandler:function(b,a,c){if(a==="error"){log(this+" Error: could not load this file")}this.complete()},start:function(){this.$target().load(this.url(),this.loadHandler.context(this))},toString:function(){return"["+this.qualifiedClassName()+" url="+this.url()+"]"}};SPITFIRE.Class(SPITFIRE.JQueryLoadTask);SPITFIRE.ParallelTask=function(){this.callSuper();this.qualifiedClassName("SPITFIRE.ParallelTask");if(arguments.length>0){this.tasks(arguments)}};SPITFIRE.ParallelTask.superclass=SPITFIRE.TaskManager;SPITFIRE.ParallelTask.prototype={taskCompleteHandler:function(b){var a=b.target();if(this.debug()){log("taskComplete "+a)}a.unbind(SPITFIRE.Event.COMPLETE,this.taskCompleteHandler.context(this));this._createdTasks.push(a);if(this._createdTasks.length===this.tasks().length){if(this.debug()){log("tasksComplete "+this)}this.complete()}},start:function(){this._createdTasks=[];if(this.tasks().length>0){var c,a,b;for(c=0,a=this.tasks().length;c<a;c+=1){b=this.tasks()[c];b.bind(SPITFIRE.Event.COMPLETE,this.taskCompleteHandler.context(this));if(this.debug()){log("taskStart "+b)}b.start()}}else{this.complete()}},toString:function(){return"["+this.qualifiedClassName()+" name="+this.name()+"]"}};SPITFIRE.Class(SPITFIRE.ParallelTask);SPITFIRE.PropertyTask=function(c,b,a){this.callSuper();this.qualifiedClassName("SPITFIRE.PropertyTask");this.target(c);this.property(b);this.value(a)};SPITFIRE.PropertyTask.superclass=SPITFIRE.Task;SPITFIRE.PropertyTask.synthesizedProperties=["target","property","value"];SPITFIRE.PropertyTask.prototype={start:function(){this.target()[this.property()](this.value());this.complete()},toString:function(){return"["+this.qualifiedClassName()+" target="+this.target()+" property="+this.property()+" value="+this.value()+"]"}};SPITFIRE.Class(SPITFIRE.PropertyTask);SPITFIRE.SequentialTask=function(){this.callSuper();this.qualifiedClassName("SPITFIRE.SequentialTask");if(arguments.length>0){this.tasks(arguments)}};SPITFIRE.SequentialTask.superclass=SPITFIRE.TaskManager;SPITFIRE.SequentialTask.synthesizedProperties=[];SPITFIRE.SequentialTask.prototype={taskCompleteHandler:function(b){var a=b.target();if(this.debug()){log("taskComplete "+a)}a.unbind(SPITFIRE.Event.COMPLETE);this._createdTasks.push(a);if(this._createdTasks.length===this.tasks().length){this.complete()}else{this.createTask()}},start:function(){this._createdTasks=[];if(this.tasks().length>0){this.createTask()}else{this.complete()}},createTask:function(){var b=this._createdTasks.length,a=this.tasks()[b];a.bind(SPITFIRE.Event.COMPLETE,this.taskCompleteHandler.context(this));if(this.debug()){log("taskStart "+a)}a.start()},toString:function(){return"["+this.qualifiedClassName()+" name="+this.name()+"]"}};SPITFIRE.Class(SPITFIRE.SequentialTask);SPITFIRE.UIButton=function(){this.callSuper();this.qualifiedClassName("SPITFIRE.UIButton")};SPITFIRE.UIButton.superclass=SPITFIRE.DisplayObject;SPITFIRE.UIButton.synthesizedProperties=[];SPITFIRE.UIButton.prototype={mouseOverHandler:function(a){this.$this().addClass("sf-over")},mouseOutHandler:function(a){this.$this().removeClass("sf-over")},clickHandler:function(a){},mouseUpHandler:function(a){this.$this().removeClass("sf-down")},mouseDownHandler:function(a){this.$this().addClass("sf-down")},init:function(){this.callSuper();SPITFIRE.addListener(this,"click","clickHandler");SPITFIRE.addListener(this,"mouseover","mouseOverHandler");SPITFIRE.addListener(this,"mouseout","mouseOutHandler");SPITFIRE.addListener(this,"mouseup","mouseUpHandler");SPITFIRE.addListener(this,"mousedown","mouseDownHandler")},toString:function(){return"["+this.qualifiedClassName()+"]"}};SPITFIRE.Class(SPITFIRE.UIButton);SPITFIRE.UICarousel=function(a){a.name=a.name||"carousel";this.config=a;this.callSuper(a.name);this.qualifiedClassName("SPITFIRE.UICarousel");this.data=a.data||[];this._items=[];this._itemWidth=a.itemWidth||270;this._itemHeight=a.itemHeight||180;this._neighbors=a.neighbors||2;this._itemDistance=a.itemDistance||160;this._speed=a.speed||500;this._scaleRatio=a.scaleRatio||0.3;this._positionIndex=0;this.$carouselContainer=(typeof a.carouselContainer!=="undefined")?$("#"+a.carouselContainer):undefined;this.hasDescriptionContainer=typeof a.descriptionContainer!=="undefined";this.$descriptionContainer=(this.hasDescriptionContainer)?$("#"+a.descriptionContainer):undefined;this.$previousButton=(typeof a.previousButton!=="undefined")?$("#"+a.previousButton):undefined;this.$nextButton=(typeof a.nextButton!=="undefined")?$("#"+a.nextButton):undefined;this.center(new SPITFIRE.Point(~~(this.$carouselContainer.width()*0.5),~~(this.$carouselContainer.height()*0.5)));this.initHandlers()};SPITFIRE.UICarousel.superclass=SPITFIRE.State;SPITFIRE.UICarousel.synthesizedProperties=["items","center","itemHeight","itemWidth","neighbors","itemDistance","positionIndex","startX","centerIndex","speed","scaleRatio"];SPITFIRE.UICarousel.prototype={setPositionIndex:function(j){var e=this._positionIndex,k=this.items()[e].carouselIndex()-this.items()[j].carouselIndex(),b,f,n,l,h,c,d,a,g,m=(this.items().length*0.5>>0)+1;for(b=0,f=this.items().length;b<f;b+=1){n=this.items()[b];l=n.carouselIndex()+k;l=(l<0||l>=f)?(l<0)?l+f:l-f:l;n.carouselIndex(l);n.carousel(this);h=n.carouselIndex()*this.itemDistance()+this.startX();c=Math.abs(this.centerIndex()-l);g=(m-c)*25;d=(c<=this.neighbors())?1:0;a=1-c*this.scaleRatio();n.animate(h,this.center().y,g,a,d,this._speed*Math.abs(k))}this._positionIndex=j;this.trigger(new SPITFIRE.Event(SPITFIRE.Event.CHANGE));this.updateDescription()},getLoadIn:function(){return this.createStatesTask()},imagesLoadedHandler:function(a){this.positionItems();this.getChildByName(this.getDefaultChild()).browse()},createStatesTask:function(){var e=new SPITFIRE.SequentialTask(),d,a,h,c,g,f,b;e.bind(SPITFIRE.Event.COMPLETE,this.imagesLoadedHandler.context(this));for(d=0,a=this.data.length;d<a;d+=1){h=this.data[d];c="item"+(d+1);g=new SPITFIRE.UICarouselItem(c,h.imageUrl,d);this.$carouselContainer.append(g.$el);e.addTask(g.loader);e.addTask(new SPITFIRE.FunctionTask(this,this.initImage,g));this.addChild(g);this._items.push(g)}if(this.data.length){this.defaultChild(this.getChildren()[this._positionIndex].getName())}return e},initImage:function(a){a.setItemDimensions(this._itemWidth,this._itemHeight)},initHandlers:function(){if(typeof this.$previousButton!=="undefined"){this.$previousButton.bind("click",$.proxy(this.previous,this))}if(typeof this.$nextButton!=="undefined"){this.$nextButton.bind("click",$.proxy(this.next,this))}},updateDescription:function(){if(!this.hasDescriptionContainer){return}var a=this.data[this.getPositionIndex()].description;a=(typeof a!=="undefined")?a:"";this.$descriptionContainer.html(a)},changeData:function(b){this.data=b;this.destroy();var a=this.createStatesTask();a.start()},positionItems:function(){var c=this._positionIndex+1,l=(this._positionIndex-1>=0)?this._positionIndex-1:this._items.length-1,d=l,b=c,g=this.getCenter().x,e=this.getCenter().y,n=this.items()[this._positionIndex],a=g+this.itemDistance(),f=g-this.itemDistance(),i,m,k=0,h=Math.ceil((this._items.length-1)*0.5),j;this.centerIndex(Math.floor(this._items.length*0.5));n.displayObject.l(g);n.displayObject.t(e);n.$img.css("opacity",1);n.carouselIndex(this.centerIndex());while(k<h){k+=1;j=(k>this.neighbors())?0:1;i=this._items[c];if(i){i.displayObject.l(a);i.displayObject.t(e);i.carouselIndex(this.centerIndex()+k);i.$img.css("opacity",j);a+=this.itemDistance();c+=1;if(c>=this._items.length){c=0}}m=this._items[l];if(m){m.displayObject.l(f);m.displayObject.t(e);m.carouselIndex(this.centerIndex()-k);m.$img.css("opacity",j);f-=this.itemDistance();l-=1;if(l<0){l=this._items.length-1}}}this.startX(m.displayObject.l())},previous:function(){var a=this._positionIndex-1;a=(a<0)?this._items.length-1:a;this._items[a].browse()},next:function(){var a=this._positionIndex+1;a=(a>=this._items.length)?0:a;this._items[a].browse()},destroy:function(){this._positionIndex=0;this.setDefaultChild(undefined);this.browse();while(this._items.length>0){var a=this._items[0];this.removeChild(a);a.destroy();a=null;this._items.shift()}}};SPITFIRE.Class(SPITFIRE.UICarousel);SPITFIRE.UICarouselItem=function(c,b,a){this.callSuper(c);this.qualifiedClassName("SPITFIRE.UICarouselItem");this._itemHeight=100;this._scale=1;this._itemIndex=a;this.loader=new SPITFIRE.JQueryImageLoaderTask(b);this.$img=this.loader.get$content();var d=document.createElement("div");d.className="carouselItemContainer";this.$el=$(d);this.$el.append(this.$img);this.displayObject=new SPITFIRE.DisplayObject(this.$el);this.imgDisplayObject=new SPITFIRE.DisplayObject(this.$img);this.imgDisplayObject.setIsCentered(true);this.$img.css("opacity",0)};SPITFIRE.UICarouselItem.superclass=SPITFIRE.State;SPITFIRE.UICarouselItem.synthesizedProperties=["itemIndex","carouselIndex","carousel","img","itemHeight","itemWidth"];SPITFIRE.UICarouselItem.prototype={getTransitionIn:function(){return new SPITFIRE.FunctionTask(this,this.transitionIn)},clickHandler:function(a){this.getParent().setPositionIndex(this.getItemIndex())},transitionIn:function(){this.getParent().setPositionIndex(this.getItemIndex())},setItemDimensions:function(b,a){this.setItemWidth(b);this.setItemHeight(a);this.imgDisplayObject.setW(this._itemWidth);this.imgDisplayObject.setH(this._itemHeight);this.imgDisplayObject.scale(this._scale)},animate:function(a,f,e,d,b,c){this.displayObject.animate({l:a,t:f,z:e},{duration:c});this.imgDisplayObject.animate({scale:d,opacity:b},{duration:c})},destroy:function(){this.displayObject.destroy();this.imgDisplayObject.destroy();this.$img.remove();this.$el.remove()}};SPITFIRE.Class(SPITFIRE.UICarouselItem);SPITFIRE.UISlideshow=function(a){a.name=a.name||"slideshow";this.config=a;this.callSuper(a.name);this.setQualifiedClassName("SPITFIRE.UISlideshow");if(typeof a==="undefined"||typeof a.imageContainer==="undefined"){throw new SPITFIRE.Error(this.toString()+" is misconfigured")}this.data=a.data||[];this.$imageContainer=$("#"+a.imageContainer);this._currentIndex=0;this.hasDescriptionContainer=typeof a.descriptionContainer!=="undefined";this.$descriptionContainer=(this.hasDescriptionContainer)?$("#"+a.descriptionContainer):undefined;this.$previousButton=(typeof a.previousButton!=="undefined")?$("#"+a.previousButton):undefined;this.$nextButton=(typeof a.nextButton!=="undefined")?$("#"+a.nextButton):undefined;this.$previousPageButton=(typeof a.previousPageButton!=="undefined")?$("#"+a.previousPageButton):undefined;this.$nextPageButton=(typeof a.nextPageButton!=="undefined")?$("#"+a.nextPageButton):undefined;this.hasLoadingIndicator=(typeof a.loadingIndicator!=="undefined");this.$loadingIndicator=(this.hasLoadingIndicator)?$("#"+a.loadingIndicator):undefined;if(this.hasLoadingIndicator){this.$loadingIndicator.hide()}this.hasDrawer=(typeof a.drawer!=="undefined");this.$drawer=(this.hasDrawer)?$("#"+a.drawer):undefined;this.disableContextMenu=(typeof a.disableContextMenu!=="undefined")?a.disableContextMenu:false;this.initStates();this.initDrawer();this.initHandlers()};SPITFIRE.UISlideshow.superclass=SPITFIRE.State;SPITFIRE.UISlideshow.synthesizedProperties=["currentIndex","currentPageIndex"];SPITFIRE.UISlideshow.prototype={setCurrentIndex:function(a){this._currentIndex=a;this.states[this._currentIndex].browse()},setCurrentPageIndex:function(a){if(this._currentPageIndex===a){return}this._currentPageIndex=a;var b=-1*this._currentPageIndex*(this._drawerThumbWidth+this._drawerGutter)*this._drawerThumbsPerPage;this.$drawer.animate({left:b},{duration:600,queue:false})},childChangeHandler:function(a){this.callSuper(a);this.updateDrawer();this.updateDescription()},thumbsLoadedHandler:function(a){},thumbClickHandler:function(a){this.setCurrentIndex(a.currentTarget.index)},initStates:function(){this.states=[];var c,a,d,b,e;for(c=0,a=this.data.length;c<a;c+=1){d=this.data[c];b="image"+(c+1);e=new SPITFIRE.UISlideshowItem(b,d.imageUrl,this.disableContextMenu);this.$imageContainer.append(e.loader.get$content());this.addChild(e);this.states.push(e)}if(this.data.length){this.defaultChild(this.getChildren()[this._currentIndex].getName())}},initDrawer:function(){if(!this.hasDrawer){return}this._drawerItemX=0;this._drawerThumbsPerPage=this.config.drawerThumbsPerPage||10;this._drawerGutter=this.config.drawerGutter||0;this._drawerThumbWidth=this.config.drawerThumbWidth||100;this._$thumbs=[];this._numPages=Math.ceil(this.data.length/this._drawerThumbsPerPage);var e=new SPITFIRE.SequentialTask(),d,a,f,b,c;e.bind(SPITFIRE.Event.COMPLETE,this.thumbsLoadedHandler.context(this));for(d=0,a=this.data.length;d<a;d+=1){f=this.data[d];c=$('<div class="slideshowThumbContainer"></div>');if(typeof f.thumbnailUrl!=="undefined"){b=new SPITFIRE.JQueryImageLoaderTask(f.thumbnailUrl);c.append(b.get$content());e.addTask(b);e.addTask(new SPITFIRE.FunctionTask(this,this.positionThumb,c))}c.hide();c[0].index=d;c.bind("click",$.proxy(this.thumbClickHandler,this));this.$drawer.append(c);this._$thumbs.push(c)}e.start()},initHandlers:function(){if(typeof this.$previousButton!=="undefined"){this.$previousButton.bind("click",$.proxy(this.previousImage,this))}if(typeof this.$nextButton!=="undefined"){this.$nextButton.bind("click",$.proxy(this.nextImage,this))}if(typeof this.$previousPageButton!=="undefined"){this.$previousPageButton.bind("click",$.proxy(this.previousPage,this))}if(typeof this.$nextPageButton!=="undefined"){this.$nextPageButton.bind("click",$.proxy(this.nextPage,this))}},positionThumb:function(a){a.css("left",this._drawerItemX);this._drawerItemX+=this._drawerThumbWidth+this._drawerGutter;a.show()},previousImage:function(){var a=this.getCurrentIndex();a-=1;a=(a<0)?this.states.length-1:a;this.setCurrentIndex(a)},nextImage:function(){var a=this.getCurrentIndex();a+=1;a=(a>=this.states.length)?0:a;this.setCurrentIndex(a)},previousPage:function(){var a=this.getCurrentPageIndex();a-=1;a=(a<0)?this._numPages-1:a;this.setCurrentPageIndex(a)},nextPage:function(){var a=this.getCurrentPageIndex();a+=1;a=(a>=this._numPages)?0:a;this.setCurrentPageIndex(a)},updateDrawer:function(){if(!this.hasDrawer){return}var c,b,d,a;for(c=0,b=this._$thumbs.length;c<b;c+=1){d=this._$thumbs[c];if(c===this.getCurrentIndex()){d.addClass("selected")}else{d.removeClass("selected")}}a=~~(this.getCurrentIndex()/this._drawerThumbsPerPage);this.setCurrentPageIndex(a)},updateDescription:function(){if(!this.hasDescriptionContainer){return}var a=this.data[this.getCurrentIndex()].description;a=(typeof a!=="undefined")?a:"";this.$descriptionContainer.html(a)}};SPITFIRE.Class(SPITFIRE.UISlideshow);SPITFIRE.UISlideshowItem=function(b,a,c){c=c||false;this.callSuper(b);this.setQualifiedClassName("SPITFIRE.UISlideshowItem");this.url=a;this.loader=new SPITFIRE.JQueryImageLoaderTask(this.url);this.loader.get$content().hide();if(c){this.loader.bind("contextmenu",function(d){d=d||window.event;if(d.stopPropagation){d.stopPropagation()}d.cancelBubble=true;return false})}};SPITFIRE.UISlideshowItem.superclass=SPITFIRE.State;SPITFIRE.UISlideshowItem.synthesizedProperties=[];SPITFIRE.UISlideshowItem.prototype={getLoadIn:function(){return new SPITFIRE.FunctionTask(this,this.loadImage)},getTransitionIn:function(){return new SPITFIRE.FunctionTask(this,this.transitionIn)},getTransitionOut:function(){return new SPITFIRE.FunctionTask(this,this.transitionOut)},loadImage:function(){this.loader.start()},transitionIn:function(){this.loader.get$content().fadeIn()},transitionOut:function(){this.loader.get$content().fadeOut()}};SPITFIRE.Class(SPITFIRE.UISlideshowItem);SPITFIRE.ArrayUtils={};SPITFIRE.ArrayUtils.getItemByKeys=function(f,b){var d=-1,e,c,a;while(++d<f.length){e=f[d];a=true;for(c in b){if(!e.hasOwnProperty(c)||e[c]!==b[c]){a=false}}if(a){return e}}return undefined};SPITFIRE.ArrayUtils.getItemsByKeys=function(g,b){var e=[],d=-1,f,c,a;while(++d<g.length){f=g[d];a=true;for(c in b){if(!f.hasOwnProperty(c)||f[c]!==b[c]){a=false}}if(a){e.push(f)}}return e};SPITFIRE.ArrayUtils.getItemByAnyKey=function(e,a){var c=-1,d,b;while(++c<e.length){d=e[c];for(b in a){if(!d.hasOwnProperty(b)||d[b]!==a[b]){return d}}}return undefined};SPITFIRE.ArrayUtils.getItemsByAnyKey=function(g,b){var e=[],d=-1,f,c,a;while(++d<g.length){f=g[d];a=true;for(c in b){if(!f.hasOwnProperty(c)||f[c]!==b[c]){e.push(f);break}}}return e};SPITFIRE.ArrayUtils.getItemByKey=function(f,d,b){var c,a,e;for(c=0,a=f.length;c<a;c+=1){e=f[c];if(e.hasOwnProperty(d)){if(e[d]===b){return e}}}return undefined};SPITFIRE.ArrayUtils.getItemsByKey=function(g,e,b){var d,a,f,c=[];for(d=0,a=g.length;d<a;d+=1){f=g[d];if(f.hasOwnProperty(e)){if(f[e]===b){c.push(f)}}}return c};SPITFIRE.ArrayUtils.hasValue=function(c,d){var b,a;for(b=0,a=c.length;b<a;b+=1){if(c[b]===d){return true}}return false};SPITFIRE.ObjectUtils={};SPITFIRE.ObjectUtils.getKeyByValue=function(c,b){for(var a in c){if(c[a]===b){return a}}return undefined};SPITFIRE.RatioUtils=SPITFIRE.RatioUtils||{widthToHeight:function(a){return a.width()/a.height()},heightToWidth:function(a){return a.height()/a.width()},scale:function(b,a,c){c=c||true;return SPITFIRE.RatioUtils._defineRect(b,b.width()*a.decimalPercentage(),b.height()*a.decimalPercentage(),c)},scaleWidth:function(b,a,c){c=c||true;return SPITFIRE.RatioUtils._defineRect(b,a*SPITFIRE.RatioUtils.widthToHeight(b),a,c)},scaleHeight:function(a,b,c){c=c||true;return SPITFIRE.RatioUtils._defineRect(a,b,b*SPITFIRE.RatioUtils.heightToWidth(a),c)},scaleToFill:function(b,c,d){d=d||true;var a=SPITFIRE.RatioUtils.scaleHeight(b,c.width(),d);if(a.height()<c.height()){a=SPITFIRE.RatioUtils.scaleWidth(b,c.height(),d)}return a},scaleToFit:function(b,c,d){d=d||true;var a=SPITFIRE.RatioUtils.scaleHeight(b,c.width(),d);if(a.height()>c.height()){a=SPITFIRE.RatioUtils.scaleWidth(b,c.height(),d)}return a},_defineRect:function(c,d,a,e){var b=c.clone();b.width(e?~~(d):d);b.height(e?~~(a):a);return b}};SPITFIRE.Timer=function(b,a){this.callSuper();this.delay(b);this.repeatCount(a||0);this.qualifiedClassName("SPITFIRE.Timer");this._interval=undefined;this._currentCount=0};SPITFIRE.Timer.superclass=SPITFIRE.EventDispatcher;SPITFIRE.Timer.synthesizedProperties=["currentCount","delay","repeatCount","running"];SPITFIRE.Timer.prototype={setRunning:function(a){throw new SPITFIRE.Error("running is read-only")},setCurrentCount:function(a){throw new SPITFIRE.Error("currentCount is read-only")},reset:function(){this.stop();this._currentCount=0},start:function(){if(this._interval){return}if(this.repeatCount()&&this.currentCount()>=this.repeatCount()){return}this._interval=setTimeout(this.tick.context(this),this.delay())},stop:function(){if(this._interval){clearTimeout(this._interval)}this._interval=undefined},tick:function(){this._currentCount+=1;if(this.repeatCount()&&this._currentCount>=this.repeatCount()){this.trigger(new SPITFIRE.TimerEvent(SPITFIRE.TimerEvent.TIMER_COMPLETE));this.reset();return}this._interval=setTimeout(this.tick.context(this),this.delay());this.trigger(new SPITFIRE.TimerEvent(SPITFIRE.TimerEvent.TIMER))}};SPITFIRE.Class(SPITFIRE.Timer);